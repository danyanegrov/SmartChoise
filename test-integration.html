<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ - SmartChoice AI</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-container">
        <div class="container">
            <h1>üß™ –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ Backend + Frontend</h1>
            
            <div class="test-section">
                <h2>1. –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h2>
                <div id="connection-status" class="status">–ü—Ä–æ–≤–µ—Ä—è–µ–º...</div>
                <button onclick="testConnection()" class="btn btn--secondary">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</button>
            </div>

            <div class="test-section">
                <h2>2. –¢–µ—Å—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</h2>
                <div class="form-group">
                    <input type="text" id="test-name" class="form-control" placeholder="–ò–º—è" value="–¢–µ—Å—Ç–æ–≤—ã–π –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å">
                </div>
                <div class="form-group">
                    <input type="email" id="test-email" class="form-control" placeholder="Email" value="test@example.com">
                </div>
                <div class="form-group">
                    <input type="password" id="test-password" class="form-control" placeholder="–ü–∞—Ä–æ–ª—å" value="password123">
                </div>
                <button onclick="testRegister()" class="btn btn--primary">–¢–µ—Å—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</button>
                <div id="register-result" class="test-result"></div>
            </div>

            <div class="test-section">
                <h2>3. –¢–µ—Å—Ç –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏—è</h2>
                <div class="form-group">
                    <input type="text" id="test-question" class="form-control" placeholder="–í–æ–ø—Ä–æ—Å" value="–ß—Ç–æ –≤—ã–±—Ä–∞—Ç—å –Ω–∞ —É–∂–∏–Ω?">
                </div>
                <div class="form-group">
                    <input type="text" id="test-option1" class="form-control" placeholder="–í–∞—Ä–∏–∞–Ω—Ç 1" value="–ü–∏—Ü—Ü–∞">
                </div>
                <div class="form-group">
                    <input type="text" id="test-option2" class="form-control" placeholder="–í–∞—Ä–∏–∞–Ω—Ç 2" value="–°—É—à–∏">
                </div>
                <button onclick="testDecision()" class="btn btn--primary">–¢–µ—Å—Ç —Ä–µ—à–µ–Ω–∏—è</button>
                <div id="decision-result" class="test-result"></div>
            </div>

            <div class="test-section">
                <h2>4. –¢–µ—Å—Ç –∏—Å—Ç–æ—Ä–∏–∏</h2>
                <button onclick="testHistory()" class="btn btn--primary">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
                <div id="history-result" class="test-result"></div>
            </div>

            <div class="test-section">
                <h2>üöÄ –ó–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h2>
                <p>–ï—Å–ª–∏ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ:</p>
                <a href="auth.html" class="btn btn--primary">–ü–µ—Ä–µ–π—Ç–∏ –∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</a>
                <a href="index.html" class="btn btn--outline">–ü—Ä—è–º–æ –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é</a>
            </div>
        </div>
    </div>

    <script src="api-service.js"></script>
    <script>
        async function testConnection() {
            const statusDiv = document.getElementById('connection-status');
            statusDiv.className = 'status';
            statusDiv.textContent = '–ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...';

            try {
                const health = await apiService.healthCheck();
                statusDiv.className = 'status status--success';
                statusDiv.textContent = `‚úÖ Backend –ø–æ–¥–∫–ª—é—á–µ–Ω: ${health.status}`;
                console.log('Health check:', health);
            } catch (error) {
                statusDiv.className = 'status status--error';
                statusDiv.textContent = `‚ùå Backend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ${error.message}`;
                console.error('Connection test failed:', error);
            }
        }

        async function testRegister() {
            const resultDiv = document.getElementById('register-result');
            resultDiv.textContent = '–¢–µ—Å—Ç–∏—Ä—É–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é...';

            try {
                const testData = {
                    name: document.getElementById('test-name').value,
                    email: document.getElementById('test-email').value + Date.now(), // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π email
                    password: document.getElementById('test-password').value,
                    age: 25,
                    personalityType: 'introvert',
                    anxietyLevel: 5
                };

                const result = await apiService.register(testData);
                resultDiv.innerHTML = `
                    <div class="status status--success">
                        ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!<br>
                        –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${result.user.name}<br>
                        ID: ${result.user.id}<br>
                        –¢–æ–∫–µ–Ω –ø–æ–ª—É—á–µ–Ω: ${result.token ? '–î–∞' : '–ù–µ—Ç'}
                    </div>
                `;
                console.log('Registration test:', result);
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="status status--error">
                        ‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ${error.message}
                    </div>
                `;
                console.error('Registration test failed:', error);
            }
        }

        async function testDecision() {
            const resultDiv = document.getElementById('decision-result');
            resultDiv.textContent = '–¢–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏—è...';

            try {
                if (!apiService.isAuthenticated()) {
                    throw new Error('–°–Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è');
                }

                const decisionData = {
                    question: document.getElementById('test-question').value,
                    options: [
                        { text: document.getElementById('test-option1').value, rating: 4 },
                        { text: document.getElementById('test-option2').value, rating: 3 }
                    ],
                    emotion: { emotion: 'neutral', confidence: 0.7 }
                };

                const result = await apiService.createSimpleDecision(decisionData);
                resultDiv.innerHTML = `
                    <div class="status status--success">
                        ‚úÖ –†–µ—à–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ!<br>
                        ID: ${result.id}<br>
                        –í—ã–±–æ—Ä: ${result.chosenOption || '–ù–µ —É–∫–∞–∑–∞–Ω'}<br>
                        –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –ò–ò: ${result.aiRecommendation ? '–ï—Å—Ç—å' : '–ù–µ—Ç'}
                    </div>
                `;
                console.log('Decision test:', result);
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="status status--error">
                        ‚ùå –û—à–∏–±–∫–∞ —Ä–µ—à–µ–Ω–∏—è: ${error.message}
                    </div>
                `;
                console.error('Decision test failed:', error);
            }
        }

        async function testHistory() {
            const resultDiv = document.getElementById('history-result');
            resultDiv.textContent = '–ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é...';

            try {
                if (!apiService.isAuthenticated()) {
                    throw new Error('–°–Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è');
                }

                const result = await apiService.getDecisionHistory();
                resultDiv.innerHTML = `
                    <div class="status status--success">
                        ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞!<br>
                        –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ—à–µ–Ω–∏–π: ${result.decisions ? result.decisions.length : 0}<br>
                        ${result.decisions && result.decisions.length > 0 ? 
                          `–ü–æ—Å–ª–µ–¥–Ω–µ–µ: ${result.decisions[0].title}` : 
                          '–†–µ—à–µ–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç'
                        }
                    </div>
                `;
                console.log('History test:', result);
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="status status--error">
                        ‚ùå –û—à–∏–±–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏: ${error.message}
                    </div>
                `;
                console.error('History test failed:', error);
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            testConnection();
        });
    </script>

    <style>
        .test-section {
            background: var(--color-surface);
            border: 1px solid var(--color-card-border);
            border-radius: var(--radius-base);
            padding: var(--space-20);
            margin-bottom: var(--space-24);
        }

        .test-section h2 {
            color: var(--color-text);
            margin-bottom: var(--space-16);
            padding-bottom: var(--space-8);
            border-bottom: 1px solid var(--color-border);
        }

        .test-result {
            margin-top: var(--space-16);
            padding: var(--space-12);
            border-radius: var(--radius-base);
            min-height: 60px;
        }

        .test-result:empty {
            display: none;
        }

        .status {
            padding: var(--space-12);
            border-radius: var(--radius-base);
            font-weight: var(--font-weight-medium);
        }

        .status--success {
            background: rgba(var(--color-success-rgb), 0.1);
            color: var(--color-success);
            border: 1px solid rgba(var(--color-success-rgb), 0.3);
        }

        .status--error {
            background: rgba(var(--color-error-rgb), 0.1);
            color: var(--color-error);
            border: 1px solid rgba(var(--color-error-rgb), 0.3);
        }

        .form-group {
            margin-bottom: var(--space-12);
        }

        .btn {
            margin-right: var(--space-12);
            margin-bottom: var(--space-8);
        }
    </style>
</body>
</html>
