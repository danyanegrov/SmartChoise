<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è - SmartChoice AI</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-container">
        <div class="auth-container">
            <div class="auth-card">
                <div class="auth-header">
                    <h1>üß† SmartChoice AI</h1>
                    <p>–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç</p>
                </div>

                <!-- –í—Ö–æ–¥ -->
                <div id="login-form" class="auth-form active">
                    <h2>–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>
                    <form id="loginForm">
                        <div class="form-group">
                            <label class="form-label">Email:</label>
                            <input type="email" id="login-email" class="form-control" placeholder="–≤–∞—à@email.com" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">–ü–∞—Ä–æ–ª—å:</label>
                            <input type="password" id="login-password" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
                        </div>
                        <button type="submit" class="btn btn--primary btn--full-width">
                            <span class="btn-text">–í–æ–π—Ç–∏</span>
                            <span class="btn-loader hidden">–ü—Ä–æ–≤–µ—Ä—è–µ–º...</span>
                        </button>
                    </form>
                    <p class="auth-switch">
                        –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="#" onclick="switchToRegister()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
                    </p>
                </div>

                <!-- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è -->
                <div id="register-form" class="auth-form">
                    <h2>–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</h2>
                    <form id="registerForm">
                        <div class="form-group">
                            <label class="form-label">–ò–º—è:</label>
                            <input type="text" id="register-name" class="form-control" placeholder="–í–∞—à–µ –∏–º—è" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email:</label>
                            <input type="email" id="register-email" class="form-control" placeholder="–≤–∞—à@email.com" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">–ü–∞—Ä–æ–ª—å:</label>
                            <input type="password" id="register-password" class="form-control" placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤" required minlength="6">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–í–æ–∑—Ä–∞—Å—Ç:</label>
                            <input type="number" id="register-age" class="form-control" placeholder="25" min="18" max="100">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–¢–∏–ø –ª–∏—á–Ω–æ—Å—Ç–∏:</label>
                            <select id="register-personality" class="form-control">
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø</option>
                                <option value="introvert">–ò–Ω—Ç—Ä–æ–≤–µ—Ä—Ç</option>
                                <option value="extrovert">–≠–∫—Å—Ç—Ä–∞–≤–µ—Ä—Ç</option>
                                <option value="ambivert">–ê–º–±–∏–≤–µ—Ä—Ç</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">–£—Ä–æ–≤–µ–Ω—å —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç–∏: <span id="anxiety-display">5</span></label>
                            <input type="range" id="register-anxiety" class="form-range" min="1" max="10" value="5">
                            <div class="range-labels">
                                <span>–ù–∏–∑–∫–∏–π</span>
                                <span>–í—ã—Å–æ–∫–∏–π</span>
                            </div>
                        </div>
                        <button type="submit" class="btn btn--primary btn--full-width">
                            <span class="btn-text">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</span>
                            <span class="btn-loader hidden">–°–æ–∑–¥–∞—ë–º...</span>
                        </button>
                    </form>
                    <p class="auth-switch">
                        –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="#" onclick="switchToLogin()">–í–æ–π—Ç–∏</a>
                    </p>
                </div>

                <!-- –î–µ–º–æ —Ä–µ–∂–∏–º -->
                <div class="demo-section">
                    <div class="divider">
                        <span>–∏–ª–∏</span>
                    </div>
                    <button class="btn btn--outline btn--full-width" onclick="demoMode()">
                        üöÄ –î–µ–º–æ —Ä–µ–∂–∏–º (–±–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)
                    </button>
                </div>
            </div>
        </div>

        <!-- Backend Status -->
        <div class="backend-status">
            <div class="status-indicator" id="backend-status">
                <span class="status-dot"></span>
                <span class="status-text">–ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</span>
            </div>
        </div>

        <!-- Toast Container -->
        <div id="toast-container" class="toast-container"></div>
    </div>

    <script src="api-service.js"></script>
    <script>
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ñ–æ—Ä–º–∞–º–∏
        function switchToRegister() {
            document.getElementById('login-form').classList.remove('active');
            document.getElementById('register-form').classList.add('active');
        }

        function switchToLogin() {
            document.getElementById('register-form').classList.remove('active');
            document.getElementById('login-form').classList.add('active');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç–∏
        document.getElementById('register-anxiety').addEventListener('input', (e) => {
            document.getElementById('anxiety-display').textContent = e.target.value;
        });

        // –î–µ–º–æ —Ä–µ–∂–∏–º
        function demoMode() {
            localStorage.setItem('demoMode', 'true');
            window.location.href = 'index.html';
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –≤—Ö–æ–¥–∞
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const btn = e.target.querySelector('button[type="submit"]');
            const btnText = btn.querySelector('.btn-text');
            const btnLoader = btn.querySelector('.btn-loader');
            
            try {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
                btn.disabled = true;
                btnText.style.opacity = '0';
                btnLoader.classList.remove('hidden');
                btnLoader.style.opacity = '1';

                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;

                const result = await apiService.login(email, password);
                
                showToast('–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥!', 'success');
                
                // –†–µ–¥–∏—Ä–µ–∫—Ç —á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1000);

            } catch (error) {
                showToast(`–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ${error.message}`, 'error');
            } finally {
                // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
                btn.disabled = false;
                btnText.style.opacity = '1';
                btnLoader.style.opacity = '0';
                setTimeout(() => btnLoader.classList.add('hidden'), 200);
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const btn = e.target.querySelector('button[type="submit"]');
            const btnText = btn.querySelector('.btn-text');
            const btnLoader = btn.querySelector('.btn-loader');
            
            try {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
                btn.disabled = true;
                btnText.style.opacity = '0';
                btnLoader.classList.remove('hidden');
                btnLoader.style.opacity = '1';

                const userData = {
                    name: document.getElementById('register-name').value,
                    email: document.getElementById('register-email').value,
                    password: document.getElementById('register-password').value,
                    age: parseInt(document.getElementById('register-age').value) || null,
                    personalityType: document.getElementById('register-personality').value || null,
                    anxietyLevel: parseInt(document.getElementById('register-anxiety').value)
                };

                const result = await apiService.register(userData);
                
                showToast('–ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!', 'success');
                
                // –†–µ–¥–∏—Ä–µ–∫—Ç —á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1000);

            } catch (error) {
                showToast(`–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ${error.message}`, 'error');
            } finally {
                // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
                btn.disabled = false;
                btnText.style.opacity = '1';
                btnLoader.style.opacity = '0';
                setTimeout(() => btnLoader.classList.add('hidden'), 200);
            }
        });

        // Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast toast--${type}`;
            toast.textContent = message;

            container.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => container.removeChild(toast), 300);
            }, 3000);
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ backend
        async function checkBackendStatus() {
            const statusIndicator = document.getElementById('backend-status');
            const statusDot = statusIndicator.querySelector('.status-dot');
            const statusText = statusIndicator.querySelector('.status-text');

            try {
                const health = await apiService.healthCheck();
                statusDot.style.background = 'var(--color-success)';
                statusText.textContent = 'Backend –ø–æ–¥–∫–ª—é—á–µ–Ω';
                console.log('‚úÖ Backend —Ä–∞–±–æ—Ç–∞–µ—Ç:', health);
            } catch (error) {
                statusDot.style.background = 'var(--color-error)';
                statusText.textContent = 'Backend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω';
                console.error('‚ùå Backend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:', error);
                showToast('–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: Backend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–µ–º–æ —Ä–µ–∂–∏–º.', 'warning');
            }
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', async () => {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å backend
            await checkBackendStatus();

            // –ï—Å–ª–∏ —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏–º
            if (apiService.isAuthenticated()) {
                try {
                    await apiService.getProfile();
                    window.location.href = 'index.html';
                } catch (error) {
                    // –¢–æ–∫–µ–Ω –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω
                    apiService.logout();
                }
            }
        });
    </script>

    <style>
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-20);
            background: linear-gradient(135deg, var(--color-bg-1), var(--color-bg-3));
        }

        .auth-card {
            background: var(--color-surface);
            border: 1px solid var(--color-card-border);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            padding: var(--space-32);
            width: 100%;
            max-width: 450px;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .auth-header {
            text-align: center;
            margin-bottom: var(--space-32);
        }

        .auth-header h1 {
            color: var(--color-primary);
            margin-bottom: var(--space-8);
            font-size: var(--font-size-3xl);
        }

        .auth-header p {
            color: var(--color-text-secondary);
            margin: 0;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .auth-form h2 {
            color: var(--color-text);
            margin-bottom: var(--space-24);
            text-align: center;
        }

        .auth-switch {
            text-align: center;
            margin-top: var(--space-20);
            color: var(--color-text-secondary);
        }

        .auth-switch a {
            color: var(--color-primary);
            text-decoration: none;
        }

        .auth-switch a:hover {
            color: var(--color-primary-hover);
        }

        .demo-section {
            margin-top: var(--space-24);
        }

        .divider {
            text-align: center;
            margin: var(--space-20) 0;
            position: relative;
        }

        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--color-border);
        }

        .divider span {
            background: var(--color-surface);
            padding: 0 var(--space-16);
            color: var(--color-text-secondary);
            font-size: var(--font-size-sm);
        }

        .backend-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: var(--space-8);
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            padding: var(--space-8) var(--space-12);
            box-shadow: var(--shadow-sm);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--color-warning);
            animation: pulse 2s infinite;
        }

        .status-text {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
        }

        @media (max-width: 480px) {
            .auth-card {
                padding: var(--space-24);
                margin: var(--space-16);
            }
        }
    </style>
</body>
</html>
